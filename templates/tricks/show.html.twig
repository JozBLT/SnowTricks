{% extends 'base.html.twig' %}

{% block body %}
    <div class="mx-60 my-20 bg-white border border-gray-200 shadow-md rounded-lg">
        <!-- Tricks Image -->
        <div class="w-full">
            {% if tricks.thumbnail %}
                <img src="{{ vich_uploader_asset(tricks, 'thumbnailFile') }}"
                     alt="preview" class="w-full rounded-t-lg object-cover">
            {% else %}
                <img src="{{ asset('images/creative_snowboard_1.jpg') }}"
                     alt="alternative_preview" class="w-full rounded-t-lg object-cover">
            {% endif %}
        </div>

        <!-- Sliders -->
        <div class="flex flex-col md:flex-row justify-between items-start gap-8 p-8">
            <!-- Images Slider -->
            {% if tricks.images|length > 0 %}
                <div id="carouselImages" class="swiper my-8 max-w-screen-lg mx-auto relative">
                    <div class="swiper-wrapper">
                        {% for image in tricks.images %}
                            <div class="swiper-slide flex justify-center items-center">
                                <img src="{{ vich_uploader_asset(image, 'imageFile') }}"
                                     alt="Image secondaire" class="rounded-lg object-cover">
                            </div>
                        {% endfor %}
                    </div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            {% endif %}

            <!-- Video Slider -->
            {% if tricks.videos|length > 0 %}
                <div id="carouselVideos" class="swiper my-8 max-w-screen-lg mx-auto relative">
                    <div class="swiper-wrapper">
                        {% for video in tricks.videos %}
                            <div class="swiper-slide flex justify-center items-center">
                                {% if 'youtube.com' in video.videoLink %}
                                    {% set youtubeId = video.videoLink|split('v=')[1] %}
                                    <iframe class="rounded-lg w-64 h-48"
                                            src="https://www.youtube.com/embed/{{ youtubeId }}"
                                            allowfullscreen>
                                    </iframe>
                                {% elseif 'dailymotion.com' in video.videoLink %}
                                    {% set dailymotionId = video.videoLink|split('/')|last %}
                                    <iframe class="rounded-lg w-64 h-48"
                                            src="https://www.dailymotion.com/embed/video/{{ dailymotionId }}"
                                            allowfullscreen>
                                    </iframe>
                                {% else %}
                                    <p>Vidéo non supportée</p>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            {% endif %}
        </div>

        <!-- Trick Content -->
        <div class="px-8 py-4 flex flex-col items-center">
            <p class="leading-relaxed w-11/12 text-center">{{ tricks.content | nl2br }}</p>
            <div class="flex justify-center items-center gap-4 mt-4">
                <p><span class="underline">Auteur</span> : {{ tricks.createdBy ? tricks.createdBy.username : 'Utilisateur supprimé' }}</p>
                <p><span class="underline">Créé le</span> : {{ tricks.createdAt|date('d/m/Y') }}</p>
                {% if tricks.updatedAt > tricks.createdAt %}
                    <p><span class="underline">Dernière modification</span> : {{ tricks.updatedAt|date('d/m/Y') }}</p>
                {% endif %}
            </div>
            <hr class="w-4/5 mt-8 border-t-2 border-gray-300">
        </div>

        <!-- Comments -->
        <div class="px-8 py-4">
            {% include 'tricks/comments.html.twig' with {'commentForm': commentForm} %}
        </div>
    </div>
{% endblock %}
